#include "envelopes.h"

float interpolate_env(uint32_t rel_pos, uint32_t length_decay, const uint16_t* lookup_table){
    float pos = static_cast<float>(rel_pos) / (length_decay) * 256.0;
    uint16_t int_pos = int(pos);
    uint16_t output;
    if (int_pos > 255) { //How to get rid of this if statement
        output = 0;
    } else {
        float frac = pos - int_pos;
        uint16_t a = lookup_table[int_pos];
        uint16_t b = lookup_table[int_pos + 1];
        output = a + frac * (b - a);
    }

    return output / 65535.0;
}

const uint16_t lambda[] = {
    12985, 12495, 12041, 11618,
    11224, 10856, 10511, 10188,
    9883, 9597, 9326, 9071,
    8829, 8599, 8381, 8174,
    7977, 7789, 7610, 7439,
    7275, 7119, 6969, 6825,
    6687, 6555, 6427, 6305,
    6187, 6073, 5963, 5858,
    5756, 5657, 5562, 5470,
    5381, 5295, 5211, 5130,
    5052, 4976, 4902, 4830,
    4760, 4693, 4627, 4563,
    4501, 4440, 4381, 4324,
    4268, 4214, 4160, 4109,
    4058, 4009, 3961, 3914,
    3868, 3823, 3779, 3736,
    3694, 3653, 3613, 3574,
    3536, 3498, 3461, 3425,
    3390, 3356, 3322, 3289,
    3256, 3224, 3193, 3162,
    3132, 3103, 3074, 3045,
    3017, 2990, 2963, 2936,
    2910, 2885, 2860, 2835,
    2811, 2787, 2763, 2740,
    2718, 2695, 2673, 2652,
    2631, 2610, 2589, 2569,
    2549, 2529, 2510, 2491,
    2472, 2453, 2435, 2417,
    2400, 2382, 2365, 2348,
    2331, 2315, 2298, 2282,
    2267, 2251, 2236, 2220,
    2205, 2191, 2176, 2162,
    2147, 2133, 2120, 2106,
    2092, 2079, 2066, 2053,
    2040, 2027, 2015, 2002,
    1990, 1978, 1966, 1954,
    1943, 1931, 1920, 1909,
    1897, 1886, 1876, 1865,
    1854, 1844, 1833, 1823,
    1813, 1803, 1793, 1783,
    1773, 1763, 1754, 1745,
    1735, 1726, 1717, 1708,
    1699, 1690, 1681, 1672,
    1664, 1655, 1647, 1639,
    1630, 1622, 1614, 1606,
    1598, 1590, 1582, 1575,
    1567, 1559, 1552, 1545,
    1537, 1530, 1523, 1515,
    1508, 1501, 1494, 1487,
    1481, 1474, 1467, 1460,
    1454, 1447, 1441, 1434,
    1428, 1422, 1415, 1409,
    1403, 1397, 1391, 1385,
    1379, 1373, 1367, 1361,
    1355, 1350, 1344, 1338,
    1333, 1327, 1322, 1316,
    1311, 1306, 1300, 1295,
    1290, 1285, 1279, 1274,
    1269, 1264, 1259, 1254,
    1249, 1244, 1240, 1235,
    1230, 1225, 1220, 1216,
    1211, 1207, 1202, 1197,
    1193, 1188, 1184, 1180,
    1175, 1171, 1167, 1162
};

const uint16_t log_env[] = {
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65535, 65535, 65535,
    65535, 65534, 65534, 65534,
    65533, 65532, 65531, 65529,
    65527, 65523, 65518, 65511,
    65501, 65487, 65467, 65440,
    65401, 65347, 65272, 65168,
    65022, 64819, 64538, 64149,
    63610, 62865, 61836, 60418,
    58465, 55780, 52093, 47036,
    40108, 30629, 17677, 0, 
    0,
};

const uint16_t exp_env[] = {
    65535, 62568, 59736, 57032,
    54450, 51986, 49632, 47386,
    45241, 43193, 41238, 39371,
    37589, 35887, 34263, 32712,
    31231, 29817, 28467, 27179,
    25948, 24774, 23652, 22582,
    21560, 20584, 19652, 18762,
    17913, 17102, 16328, 15589,
    14883, 14209, 13566, 12952,
    12366, 11806, 11272, 10761,
    10274, 9809, 9365, 8941,
    8536, 8150, 7781, 7429,
    7093, 6772, 6465, 6172,
    5893, 5626, 5372, 5128,
    4896, 4675, 4463, 4261,
    4068, 3884, 3708, 3540,
    3380, 3227, 3081, 2941,
    2808, 2681, 2560, 2444,
    2333, 2228, 2127, 2031,
    1939, 1851, 1767, 1687,
    1611, 1538, 1468, 1402,
    1338, 1278, 1220, 1165,
    1112, 1062, 1014, 968,
    924, 882, 842, 804,
    768, 733, 700, 668,
    638, 609, 581, 555,
    530, 506, 483, 461,
    440, 420, 401, 383,
    366, 349, 333, 318,
    304, 290, 277, 264,
    253, 241, 230, 220,
    210, 200, 191, 183,
    174, 166, 159, 152,
    145, 138, 132, 126,
    120, 115, 110, 105,
    100, 95, 91, 87,
    83, 79, 76, 72,
    69, 66, 63, 60,
    57, 55, 52, 50,
    48, 45, 43, 41,
    40, 38, 36, 34,
    33, 31, 30, 29,
    27, 26, 25, 24,
    23, 22, 21, 20,
    19, 18, 17, 16,
    16, 15, 14, 14,
    13, 12, 12, 11,
    11, 10, 10, 9,
    9, 9, 8, 8,
    7, 7, 7, 7,
    6, 6, 6, 5,
    5, 5, 5, 4,
    4, 4, 4, 4,
    4, 3, 3, 3,
    3, 3, 3, 3,
    2, 2, 2, 2,
    2, 2, 2, 2,
    2, 2, 2, 1,
    1, 1, 1, 1,
    1, 1, 1, 1,
    1, 1, 1, 1,
    1, 1, 1, 1,
    1, 1, 1, 1,
    1, 1, 1, 0,
    0
};